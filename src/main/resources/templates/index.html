<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming Musicale</title>

    <link rel="stylesheet" th:href="@{style/main.css}">
</head>
<body>
<header>
    <label>
        <input id="search-input" type="text" placeholder="Cerca una canzone..."><button onclick="getSong(document.getElementById('search-input').textContent)">Cerca</button>
    </label>
    <div class="profile">
        <img th:src="@{/images/account.png}" alt="ðŸ‘¤">
        <ul class="profile-menu">
            <li th:text="${user.getName()}"></li>

            <li th:if='${user.getRole().equals("ADMIN")}'><a href="/admin/addSong.html">Aggiungi una canzone</a></li>
        </ul>
    </div>
</header>

<div class="container">
    <aside>
        <h3>Playlist</h3>
        <ul>
            <li>Playlist 1</li>
            <li>Playlist 2</li>
            <li>Playlist 3</li>
        </ul>
    </aside>
    <main>
        <h2>Lista Canzoni</h2>
        <ul id="song-list"></ul>
    </main>
</div>

<div class="player">
    <audio id="myAudio" controls></audio>
</div>

<script>
    function getSong(name) {
        fetch('/song/get?name=' + encodeURIComponent(name))
            .then(response => {
                if (!response.ok) {
                    throw new Error('Errore nel recupero del file audio');
                }
                return response.json();
            })
            .then(songs => {
                let ul = document.getElementById("song-list");
                ul.innerHTML = ""; // Pulisce la lista prima di aggiungere nuove canzoni

                if (songs.length === 0) {
                    let li = document.createElement("li");
                    li.textContent = "Nessuna canzone trovata";
                    ul.appendChild(li);
                    return;
                }

                songs.forEach(song => {
                    let li = document.createElement("li");

                    // Creiamo il contenuto della lista
                    li.innerHTML = `
                <strong>${song.name}</strong> - ${song.singer}
                <br>`;
                    li.onclick=function () {
                        let audioPlayer=document.getElementById('myAudio')
                        audioPlayer.src=song.songUrl
                        audioPlayer.play()
                    }

                    ul.appendChild(li);
                });
            })
            .catch(error => {
                console.error('Errore:', error);
            })
    }
</script>
</body>
</html>
